<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management System</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
            transition: all 0.3s;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-header h3 {
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu h4 {
            padding: 0 20px;
            margin-bottom: 10px;
            font-size: 12px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li a {
            display: block;
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .sidebar-menu li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar-menu li a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .sidebar-menu li a i {
            margin-right: 10px;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .header h2 {
            color: var(--dark-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-details span:first-child {
            font-weight: bold;
        }
        
        .user-details span:last-child {
            font-size: 12px;
            color: #777;
        }
        
        /* Dashboard Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-header h3 {
            font-size: 16px;
            color: #777;
        }
        
        .card-header i {
            font-size: 24px;
            color: var(--primary-color);
        }
        
        .card-body h2 {
            font-size: 28px;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .card-footer {
            margin-top: 15px;
            font-size: 12px;
            color: #777;
        }
        
        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        table tr:hover {
            background-color: #f8f9fa;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status.inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Forms */
        .form-container {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-3 {
            margin-top: 15px;
        }
        
        .mb-3 {
            margin-bottom: 15px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 5px;
            width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-header h3 {
            margin: 0;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f5f5f5;
        }
        
        .login-card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 400px;
            max-width: 90%;
            padding: 30px;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header h2 {
            color: var(--dark-color);
            margin-bottom: 10px;
        }
        
        .login-header p {
            color: #777;
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #777;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar-header h3, 
            .sidebar-menu h4,
            .sidebar-menu li a span {
                display: none;
            }
            
            .sidebar-menu li a {
                text-align: center;
                padding: 15px 0;
            }
            
            .sidebar-menu li a i {
                margin-right: 0;
                font-size: 20px;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 7px;
            font-size: 12px;
            font-weight: bold;
            line-height: 1;
            color: white;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            border-radius: 10px;
        }
        
        .badge-primary {
            background-color: var(--primary-color);
        }
        
        .badge-success {
            background-color: var(--success-color);
        }
        
        .badge-warning {
            background-color: var(--warning-color);
        }
        
        .badge-danger {
            background-color: var(--danger-color);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h2>School Management System</h2>
                <p>Sign in to access your account</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Sign In</button>
            </form>
            <div class="login-footer">
                <p>Don't have an account? Contact administrator</p>
            </div>
        </div>
    </div>

    <!-- Main App (hidden by default) -->
    <div id="app" style="display: none;">
        <div class="sidebar">
            <div class="sidebar-header">
                <h3 id="school-name">School Name</h3>
                <p id="current-role">Role</p>
            </div>
            <div class="sidebar-menu">
                <h4>Main</h4>
                <ul>
                    <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                </ul>
                
                <h4>Management</h4>
                <ul>
                    <li><a href="#" data-page="students"><i class="fas fa-users"></i> <span>Students</span></a></li>
                    <li><a href="#" data-page="teachers"><i class="fas fa-chalkboard-teacher"></i> <span>Teachers</span></a></li>
                    <li><a href="#" data-page="staff"><i class="fas fa-user-tie"></i> <span>Staff</span></a></li>
                </ul>
                
                <h4>Academic</h4>
                <ul>
                    <li><a href="#" data-page="classes"><i class="fas fa-school"></i> <span>Classes</span></a></li>
                    <li><a href="#" data-page="subjects"><i class="fas fa-book"></i> <span>Subjects</span></a></li>
                    <li><a href="#" data-page="exams"><i class="fas fa-clipboard-list"></i> <span>Exams</span></a></li>
                </ul>
                
                <h4>Finance</h4>
                <ul>
                    <li><a href="#" data-page="fees"><i class="fas fa-money-bill-wave"></i> <span>Fee Management</span></a></li>
                    <li><a href="#" data-page="payments"><i class="fas fa-receipt"></i> <span>Payments</span></a></li>
                    <li><a href="#" data-page="expenses"><i class="fas fa-file-invoice-dollar"></i> <span>Expenses</span></a></li>
                </ul>
                
                <h4>System</h4>
                <ul>
                    <li><a href="#" data-page="users"><i class="fas fa-user-cog"></i> <span>Users</span></a></li>
                    <li><a href="#" data-page="settings"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
                </ul>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h2 id="page-title">Dashboard</h2>
                <div class="user-info">
                    <img src="https://via.placeholder.com/40" alt="User">
                    <div class="user-details">
                        <span id="logged-in-user">John Doe</span>
                        <span id="logged-in-role">Admin</span>
                    </div>
                    <button id="logout-btn" class="btn btn-danger btn-sm ml-3">Logout</button>
                </div>
            </div>
            
            <!-- Dynamic content will be loaded here -->
            <div id="content-area"></div>
        </div>
    </div>

    <!-- Modal for various actions -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <span class="close">&times;</span>
            </div>
            <div id="modal-body">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Data structure for the application
        const dataStructure = {
            users: [
                {
                    id: 1,
                    username: 'admin',
                    password: 'admin123', // In real app, this should be hashed
                    role: 'admin',
                    name: 'System Administrator',
                    email: 'admin@school.edu',
                    phone: '1234567890',
                    status: 'active',
                    lastLogin: null
                }
            ],
            roles: [
                { id: 'admin', name: 'Administrator', permissions: ['all'] },
                { id: 'bog', name: 'BOG Director', permissions: ['all'] },
                { id: 'headteacher', name: 'Head Teacher', permissions: ['students', 'teachers', 'staff', 'classes', 'subjects', 'exams', 'fees', 'payments'] },
                { id: 'teacher', name: 'Teacher', permissions: ['students:view', 'classes:view', 'subjects:view', 'exams:submit'] },
                { id: 'bursar', name: 'Bursar', permissions: ['fees', 'payments', 'expenses'] },
                { id: 'cashier', name: 'Cashier', permissions: ['payments:create'] }
            ],
            students: [],
            teachers: [],
            staff: [],
            classes: [],
            subjects: [],
            exams: [],
            fees: [],
            payments: [],
            expenses: [],
            settings: {
                schoolName: 'Sample School',
                academicYear: '2023/2024',
                term: '1',
                logo: ''
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize local storage if empty
            if (!localStorage.getItem('sms_data')) {
                localStorage.setItem('sms_data', JSON.stringify(dataStructure));
            }
            
            // Login form submission
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const user = data.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // Update last login
                    user.lastLogin = new Date().toISOString();
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    // Store current user in session
                    sessionStorage.setItem('current_user', JSON.stringify(user));
                    
                    // Show the app
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('app').style.display = 'flex';
                    
                    // Load user data
                    loadUserData();
                    
                    // Load dashboard
                    loadPage('dashboard');
                } else {
                    alert('Invalid username or password');
                }
            });
            
            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                sessionStorage.removeItem('current_user');
                document.getElementById('app').style.display = 'none';
                document.getElementById('login-page').style.display = 'flex';
                document.getElementById('login-form').reset();
            });
            
            // Sidebar navigation
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Load the page
                    const page = this.getAttribute('data-page');
                    loadPage(page);
                });
            });
            
            // Modal close button
            document.querySelector('.close').addEventListener('click', function() {
                document.getElementById('modal').style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('modal')) {
                    document.getElementById('modal').style.display = 'none';
                }
            });
        });
        
        // Load user data into the UI
        function loadUserData() {
            const user = JSON.parse(sessionStorage.getItem('current_user'));
            if (user) {
                document.getElementById('logged-in-user').textContent = user.name;
                document.getElementById('logged-in-role').textContent = user.role;
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const role = data.roles.find(r => r.id === user.role);
                document.getElementById('current-role').textContent = role ? role.name : user.role;
                
                document.getElementById('school-name').textContent = data.settings.schoolName;
            }
        }
        
        // Load a page based on the page name
        function loadPage(page) {
            document.getElementById('page-title').textContent = page.charAt(0).toUpperCase() + page.slice(1);
            
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = '';
            
            switch(page) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'students':
                    loadStudents();
                    break;
                case 'teachers':
                    loadTeachers();
                    break;
                case 'staff':
                    loadStaff();
                    break;
                case 'classes':
                    loadClasses();
                    break;
                case 'subjects':
                    loadSubjects();
                    break;
                case 'exams':
                    loadExams();
                    break;
                case 'fees':
                    loadFees();
                    break;
                case 'payments':
                    loadPayments();
                    break;
                case 'expenses':
                    loadExpenses();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                default:
                    contentArea.innerHTML = '<p>Page not found</p>';
            }
        }
        
        // Load dashboard page
        function loadDashboard() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <h3>Students</h3>
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-body">
                            <h2>${data.students.length}</h2>
                            <p>Total registered students</p>
                        </div>
                        <div class="card-footer">
                            <a href="#" onclick="loadPage('students')">View all students</a>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Teachers</h3>
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="card-body">
                            <h2>${data.teachers.length}</h2>
                            <p>Total teaching staff</p>
                        </div>
                        <div class="card-footer">
                            <a href="#" onclick="loadPage('teachers')">View all teachers</a>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Staff</h3>
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="card-body">
                            <h2>${data.staff.length}</h2>
                            <p>Total non-teaching staff</p>
                        </div>
                        <div class="card-footer">
                            <a href="#" onclick="loadPage('staff')">View all staff</a>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Payments</h3>
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="card-body">
                            <h2>$${data.payments.reduce((sum, payment) => sum + payment.amount, 0)}</h2>
                            <p>Total payments received</p>
                        </div>
                        <div class="card-footer">
                            <a href="#" onclick="loadPage('payments')">View all payments</a>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Recent Students</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Parent Contact</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.students.slice(0, 5).map(student => `
                                <tr>
                                    <td>${student.id}</td>
                                    <td>${student.firstName} ${student.lastName}</td>
                                    <td>${student.class || 'N/A'}</td>
                                    <td>${student.parentPhone || 'N/A'}</td>
                                    <td><span class="status active">Active</span></td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" onclick="viewStudent(${student.id})">View</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="text-center mt-3">
                        <a href="#" onclick="loadPage('students')">View all students</a>
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Load students page
        function loadStudents() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddStudentModal()">
                        <i class="fas fa-plus"></i> Add Student
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Parent Contact</th>
                                <th>Gender</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.students.map(student => `
                                <tr>
                                    <td>${student.id}</td>
                                    <td>${student.firstName} ${student.lastName}</td>
                                    <td>${student.class || 'N/A'}</td>
                                    <td>${student.parentPhone || 'N/A'}</td>
                                    <td>${student.gender || 'N/A'}</td>
                                    <td><span class="status ${student.status || 'active'}">${student.status || 'Active'}</span></td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" onclick="viewStudent(${student.id})">View</button>
                                        <button class="btn btn-success btn-sm" onclick="editStudent(${student.id})">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add student modal
        function showAddStudentModal() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const classes = data.classes;
            
            const modalContent = `
                <form id="add-student-form">
                    <div class="form-group">
                        <label for="student-first-name">First Name</label>
                        <input type="text" id="student-first-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="student-last-name">Last Name</label>
                        <input type="text" id="student-last-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="student-class">Class</label>
                        <select id="student-class" class="form-control">
                            <option value="">Select Class</option>
                            ${classes.map(cls => `<option value="${cls.name}">${cls.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="student-gender">Gender</label>
                        <select id="student-gender" class="form-control">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="student-dob">Date of Birth</label>
                        <input type="date" id="student-dob" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="student-parent-name">Parent/Guardian Name</label>
                        <input type="text" id="student-parent-name" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="student-parent-phone">Parent/Guardian Phone</label>
                        <input type="tel" id="student-parent-phone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="student-address">Address</label>
                        <textarea id="student-address" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Student</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Student';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-student-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.students.length > 0 ? Math.max(...data.students.map(s => s.id)) + 1 : 1;
                
                const newStudent = {
                    id: newId,
                    firstName: document.getElementById('student-first-name').value,
                    lastName: document.getElementById('student-last-name').value,
                    class: document.getElementById('student-class').value,
                    gender: document.getElementById('student-gender').value,
                    dob: document.getElementById('student-dob').value,
                    parentName: document.getElementById('student-parent-name').value,
                    parentPhone: document.getElementById('student-parent-phone').value,
                    address: document.getElementById('student-address').value,
                    status: 'active',
                    createdAt: new Date().toISOString()
                };
                
                data.students.push(newStudent);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Student added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('students');
            });
        }
        
        // View student details
        function viewStudent(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const student = data.students.find(s => s.id === id);
            
            if (!student) {
                alert('Student not found');
                return;
            }
            
            const modalContent = `
                <div class="student-profile">
                    <div class="student-header mb-3">
                        <h4>${student.firstName} ${student.lastName}</h4>
                        <p>Student ID: ${student.id}</p>
                    </div>
                    
                    <div class="tabs mb-3">
                        <div class="tab active" data-tab="info">Basic Info</div>
                        <div class="tab" data-tab="academic">Academic</div>
                        <div class="tab" data-tab="fees">Fees</div>
                    </div>
                    
                    <div class="tab-content active" id="info-tab">
                        <table class="table table-bordered">
                            <tr>
                                <th>Class</th>
                                <td>${student.class || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Gender</th>
                                <td>${student.gender || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Date of Birth</th>
                                <td>${student.dob || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Parent/Guardian</th>
                                <td>${student.parentName || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Parent Phone</th>
                                <td>${student.parentPhone || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Address</th>
                                <td>${student.address || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td><span class="status ${student.status || 'active'}">${student.status || 'Active'}</span></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="academic-tab">
                        <p>Academic records will be displayed here.</p>
                    </div>
                    
                    <div class="tab-content" id="fees-tab">
                        <p>Fee payment history will be displayed here.</p>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Student: ${student.firstName} ${student.lastName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        // Edit student
        function editStudent(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const student = data.students.find(s => s.id === id);
            const classes = data.classes;
            
            if (!student) {
                alert('Student not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-student-form">
                    <input type="hidden" id="edit-student-id" value="${student.id}">
                    <div class="form-group">
                        <label for="edit-student-first-name">First Name</label>
                        <input type="text" id="edit-student-first-name" class="form-control" value="${student.firstName || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-student-last-name">Last Name</label>
                        <input type="text" id="edit-student-last-name" class="form-control" value="${student.lastName || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-student-class">Class</label>
                        <select id="edit-student-class" class="form-control">
                            <option value="">Select Class</option>
                            ${classes.map(cls => `<option value="${cls.name}" ${student.class === cls.name ? 'selected' : ''}>${cls.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-student-gender">Gender</label>
                        <select id="edit-student-gender" class="form-control">
                            <option value="Male" ${student.gender === 'Male' ? 'selected' : ''}>Male</option>
                            <option value="Female" ${student.gender === 'Female' ? 'selected' : ''}>Female</option>
                            <option value="Other" ${student.gender === 'Other' ? 'selected' : ''}>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-student-dob">Date of Birth</label>
                        <input type="date" id="edit-student-dob" class="form-control" value="${student.dob || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-student-parent-name">Parent/Guardian Name</label>
                        <input type="text" id="edit-student-parent-name" class="form-control" value="${student.parentName || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-student-parent-phone">Parent/Guardian Phone</label>
                        <input type="tel" id="edit-student-parent-phone" class="form-control" value="${student.parentPhone || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-student-address">Address</label>
                        <textarea id="edit-student-address" class="form-control" rows="3">${student.address || ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-student-status">Status</label>
                        <select id="edit-student-status" class="form-control">
                            <option value="active" ${student.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${student.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            <option value="graduated" ${student.status === 'graduated' ? 'selected' : ''}>Graduated</option>
                            <option value="transferred" ${student.status === 'transferred' ? 'selected' : ''}>Transferred</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Student</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Student: ${student.firstName} ${student.lastName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-student-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const studentIndex = data.students.findIndex(s => s.id === id);
                
                if (studentIndex !== -1) {
                    data.students[studentIndex] = {
                        ...data.students[studentIndex],
                        firstName: document.getElementById('edit-student-first-name').value,
                        lastName: document.getElementById('edit-student-last-name').value,
                        class: document.getElementById('edit-student-class').value,
                        gender: document.getElementById('edit-student-gender').value,
                        dob: document.getElementById('edit-student-dob').value,
                        parentName: document.getElementById('edit-student-parent-name').value,
                        parentPhone: document.getElementById('edit-student-parent-phone').value,
                        address: document.getElementById('edit-student-address').value,
                        status: document.getElementById('edit-student-status').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    alert('Student updated successfully!');
                    document.getElementById('modal').style.display = 'none';
                    loadPage('students');
                }
            });
        }
        
        // Delete student
        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const studentIndex = data.students.findIndex(s => s.id === id);
                
                if (studentIndex !== -1) {
                    data.students.splice(studentIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Student deleted successfully!');
                    loadPage('students');
                }
            }
        }
        
        // Load teachers page
        function loadTeachers() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddTeacherModal()">
                        <i class="fas fa-plus"></i> Add Teacher
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Subjects</th>
                                <th>Class</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.teachers.map(teacher => `
                                <tr>
                                    <td>${teacher.id}</td>
                                    <td>${teacher.firstName} ${teacher.lastName}</td>
                                    <td>${teacher.subjects ? teacher.subjects.join(', ') : 'N/A'}</td>
                                    <td>${teacher.class || 'N/A'}</td>
                                    <td>${teacher.phone || 'N/A'}</td>
                                    <td><span class="status ${teacher.status || 'active'}">${teacher.status || 'Active'}</span></td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" onclick="viewTeacher(${teacher.id})">View</button>
                                        <button class="btn btn-success btn-sm" onclick="editTeacher(${teacher.id})">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteTeacher(${teacher.id})">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add teacher modal
        function showAddTeacherModal() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const classes = data.classes;
            const subjects = data.subjects;
            
            const modalContent = `
                <form id="add-teacher-form">
                    <div class="form-group">
                        <label for="teacher-first-name">First Name</label>
                        <input type="text" id="teacher-first-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-last-name">Last Name</label>
                        <input type="text" id="teacher-last-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-email">Email</label>
                        <input type="email" id="teacher-email" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="teacher-phone">Phone</label>
                        <input type="tel" id="teacher-phone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="teacher-class">Class Teacher Of</label>
                        <select id="teacher-class" class="form-control">
                            <option value="">Not a class teacher</option>
                            ${classes.map(cls => `<option value="${cls.name}">${cls.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="teacher-subjects">Subjects (Hold Ctrl to select multiple)</label>
                        <select id="teacher-subjects" class="form-control" multiple>
                            ${subjects.map(subj => `<option value="${subj.name}">${subj.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="teacher-qualification">Qualification</label>
                        <input type="text" id="teacher-qualification" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="teacher-join-date">Join Date</label>
                        <input type="date" id="teacher-join-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Teacher</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Teacher';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-teacher-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.teachers.length > 0 ? Math.max(...data.teachers.map(t => t.id)) + 1 : 1;
                
                const selectedSubjects = Array.from(document.getElementById('teacher-subjects').selectedOptions)
                    .map(option => option.value);
                
                const newTeacher = {
                    id: newId,
                    firstName: document.getElementById('teacher-first-name').value,
                    lastName: document.getElementById('teacher-last-name').value,
                    email: document.getElementById('teacher-email').value,
                    phone: document.getElementById('teacher-phone').value,
                    class: document.getElementById('teacher-class').value,
                    subjects: selectedSubjects,
                    qualification: document.getElementById('teacher-qualification').value,
                    joinDate: document.getElementById('teacher-join-date').value,
                    status: 'active',
                    createdAt: new Date().toISOString()
                };
                
                data.teachers.push(newTeacher);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Teacher added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('teachers');
            });
        }
        
        // View teacher details
        function viewTeacher(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const teacher = data.teachers.find(t => t.id === id);
            
            if (!teacher) {
                alert('Teacher not found');
                return;
            }
            
            const modalContent = `
                <div class="teacher-profile">
                    <div class="teacher-header mb-3">
                        <h4>${teacher.firstName} ${teacher.lastName}</h4>
                        <p>Teacher ID: ${teacher.id}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Email</th>
                            <td>${teacher.email || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Phone</th>
                            <td>${teacher.phone || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Class Teacher Of</th>
                            <td>${teacher.class || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Subjects</th>
                            <td>${teacher.subjects ? teacher.subjects.join(', ') : 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Qualification</th>
                            <td>${teacher.qualification || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Join Date</th>
                            <td>${teacher.joinDate || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Status</th>
                            <td><span class="status ${teacher.status || 'active'}">${teacher.status || 'Active'}</span></td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Teacher: ${teacher.firstName} ${teacher.lastName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Edit teacher
        function editTeacher(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const teacher = data.teachers.find(t => t.id === id);
            const classes = data.classes;
            const subjects = data.subjects;
            
            if (!teacher) {
                alert('Teacher not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-teacher-form">
                    <input type="hidden" id="edit-teacher-id" value="${teacher.id}">
                    <div class="form-group">
                        <label for="edit-teacher-first-name">First Name</label>
                        <input type="text" id="edit-teacher-first-name" class="form-control" value="${teacher.firstName || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-last-name">Last Name</label>
                        <input type="text" id="edit-teacher-last-name" class="form-control" value="${teacher.lastName || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-email">Email</label>
                        <input type="email" id="edit-teacher-email" class="form-control" value="${teacher.email || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-phone">Phone</label>
                        <input type="tel" id="edit-teacher-phone" class="form-control" value="${teacher.phone || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-class">Class Teacher Of</label>
                        <select id="edit-teacher-class" class="form-control">
                            <option value="">Not a class teacher</option>
                            ${classes.map(cls => `<option value="${cls.name}" ${teacher.class === cls.name ? 'selected' : ''}>${cls.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-subjects">Subjects (Hold Ctrl to select multiple)</label>
                        <select id="edit-teacher-subjects" class="form-control" multiple>
                            ${subjects.map(subj => {
                                const isSelected = teacher.subjects && teacher.subjects.includes(subj.name);
                                return `<option value="${subj.name}" ${isSelected ? 'selected' : ''}>${subj.name}</option>`;
                            }).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-qualification">Qualification</label>
                        <input type="text" id="edit-teacher-qualification" class="form-control" value="${teacher.qualification || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-join-date">Join Date</label>
                        <input type="date" id="edit-teacher-join-date" class="form-control" value="${teacher.joinDate || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-teacher-status">Status</label>
                        <select id="edit-teacher-status" class="form-control">
                            <option value="active" ${teacher.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${teacher.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            <option value="retired" ${teacher.status === 'retired' ? 'selected' : ''}>Retired</option>
                            <option value="transferred" ${teacher.status === 'transferred' ? 'selected' : ''}>Transferred</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Teacher</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Teacher: ${teacher.firstName} ${teacher.lastName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-teacher-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const teacherIndex = data.teachers.findIndex(t => t.id === id);
                
                if (teacherIndex !== -1) {
                    const selectedSubjects = Array.from(document.getElementById('edit-teacher-subjects').selectedOptions)
                        .map(option => option.value);
                    
                    data.teachers[teacherIndex] = {
                        ...data.teachers[teacherIndex],
                        firstName: document.getElementById('edit-teacher-first-name').value,
                        lastName: document.getElementById('edit-teacher-last-name').value,
                        email: document.getElementById('edit-teacher-email').value,
                        phone: document.getElementById('edit-teacher-phone').value,
                        class: document.getElementById('edit-teacher-class').value,
                        subjects: selectedSubjects,
                        qualification: document.getElementById('edit-teacher-qualification').value,
                        joinDate: document.getElementById('edit-teacher-join-date').value,
                        status: document.getElementById('edit-teacher-status').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    alert('Teacher updated successfully!');
                    document.getElementById('modal').style.display = 'none';
                    loadPage('teachers');
                }
            });
        }
        
        // Delete teacher
        function deleteTeacher(id) {
            if (confirm('Are you sure you want to delete this teacher?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const teacherIndex = data.teachers.findIndex(t => t.id === id);
                
                if (teacherIndex !== -1) {
                    data.teachers.splice(teacherIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Teacher deleted successfully!');
                    loadPage('teachers');
                }
            }
        }
        
        // Load staff page
        function loadStaff() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddStaffModal()">
                        <i class="fas fa-plus"></i> Add Staff
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Department</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.staff.map(staff => `
                                <tr>
                                    <td>${staff.id}</td>
                                    <td>${staff.firstName} ${staff.lastName}</td>
                                    <td>${staff.position || 'N/A'}</td>
                                    <td>${staff.department || 'N/A'}</td>
                                    <td>${staff.phone || 'N/A'}</td>
                                    <td><span class="status ${staff.status || 'active'}">${staff.status || 'Active'}</span></td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" onclick="viewStaff(${staff.id})">View</button>
                                        <button class="btn btn-success btn-sm" onclick="editStaff(${staff.id})">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteStaff(${staff.id})">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add staff modal
        function showAddStaffModal() {
            const modalContent = `
                <form id="add-staff-form">
                    <div class="form-group">
                        <label for="staff-first-name">First Name</label>
                        <input type="text" id="staff-first-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-last-name">Last Name</label>
                        <input type="text" id="staff-last-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-position">Position</label>
                        <input type="text" id="staff-position" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-department">Department</label>
                        <input type="text" id="staff-department" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="staff-email">Email</label>
                        <input type="email" id="staff-email" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="staff-phone">Phone</label>
                        <input type="tel" id="staff-phone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="staff-join-date">Join Date</label>
                        <input type="date" id="staff-join-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Staff</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Staff';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-staff-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.staff.length > 0 ? Math.max(...data.staff.map(s => s.id)) + 1 : 1;
                
                const newStaff = {
                    id: newId,
                    firstName: document.getElementById('staff-first-name').value,
                    lastName: document.getElementById('staff-last-name').value,
                    position: document.getElementById('staff-position').value,
                    department: document.getElementById('staff-department').value,
                    email: document.getElementById('staff-email').value,
                    phone: document.getElementById('staff-phone').value,
                    joinDate: document.getElementById('staff-join-date').value,
                    status: 'active',
                    createdAt: new Date().toISOString()
                };
                
                data.staff.push(newStaff);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Staff added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('staff');
            });
        }
        
        // View staff details
        function viewStaff(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const staff = data.staff.find(s => s.id === id);
            
            if (!staff) {
                alert('Staff not found');
                return;
            }
            
            const modalContent = `
                <div class="staff-profile">
                    <div class="staff-header mb-3">
                        <h4>${staff.firstName} ${staff.lastName}</h4>
                        <p>Staff ID: ${staff.id}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Position</th>
                            <td>${staff.position || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Department</th>
                            <td>${staff.department || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Email</th>
                            <td>${staff.email || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Phone</th>
                            <td>${staff.phone || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Join Date</th>
                            <td>${staff.joinDate || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Status</th>
                            <td><span class="status ${staff.status || 'active'}">${staff.status || 'Active'}</span></td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Staff: ${staff.firstName} ${staff.lastName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Edit staff
        function editStaff(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const staff = data.staff.find(s => s.id === id);
            
            if (!staff) {
                alert('Staff not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-staff-form">
                    <input type="hidden" id="edit-staff-id" value="${staff.id}">
                    <div class="form-group">
                        <label for="edit-staff-first-name">First Name</label>
                        <input type="text" id="edit-staff-first-name" class="form-control" value="${staff.firstName || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-last-name">Last Name</label>
                        <input type="text" id="edit-staff-last-name" class="form-control" value="${staff.lastName || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-position">Position</label>
                        <input type="text" id="edit-staff-position" class="form-control" value="${staff.position || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-department">Department</label>
                        <input type="text" id="edit-staff-department" class="form-control" value="${staff.department || ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-email">Email</label>
                        <input type="email" id="edit-staff-email" class="form-control" value="${staff.email || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-phone">Phone</label>
                        <input type="tel" id="edit-staff-phone" class="form-control" value="${staff.phone || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-join-date">Join Date</label>
                        <input type="date" id="edit-staff-join-date" class="form-control" value="${staff.joinDate || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-staff-status">Status</label>
                        <select id="edit-staff-status" class="form-control">
                            <option value="active" ${staff.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${staff.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            <option value="retired" ${staff.status === 'retired' ? 'selected' : ''}>Retired</option>
                            <option value="transferred" ${staff.status === 'transferred' ? 'selected' : ''}>Transferred</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Staff</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Staff: ${staff.firstName} ${staff.lastName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-staff-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const staffIndex = data.staff.findIndex(s => s.id === id);
                
                if (staffIndex !== -1) {
                    data.staff[staffIndex] = {
                        ...data.staff[staffIndex],
                        firstName: document.getElementById('edit-staff-first-name').value,
                        lastName: document.getElementById('edit-staff-last-name').value,
                        position: document.getElementById('edit-staff-position').value,
                        department: document.getElementById('edit-staff-department').value,
                        email: document.getElementById('edit-staff-email').value,
                        phone: document.getElementById('edit-staff-phone').value,
                        joinDate: document.getElementById('edit-staff-join-date').value,
                        status: document.getElementById('edit-staff-status').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    alert('Staff updated successfully!');
                    document.getElementById('modal').style.display = 'none';
                    loadPage('staff');
                }
            });
        }
        
        // Delete staff
        function deleteStaff(id) {
            if (confirm('Are you sure you want to delete this staff member?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const staffIndex = data.staff.findIndex(s => s.id === id);
                
                if (staffIndex !== -1) {
                    data.staff.splice(staffIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Staff deleted successfully!');
                    loadPage('staff');
                }
            }
        }
        
        // Load classes page
        function loadClasses() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddClassModal()">
                        <i class="fas fa-plus"></i> Add Class
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Class Name</th>
                                <th>Class Teacher</th>
                                <th>Number of Students</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.classes.map(cls => {
                                const teacher = data.teachers.find(t => t.class === cls.name);
                                const students = data.students.filter(s => s.class === cls.name);
                                return `
                                    <tr>
                                        <td>${cls.name}</td>
                                        <td>${teacher ? `${teacher.firstName} ${teacher.lastName}` : 'Not assigned'}</td>
                                        <td>${students.length}</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="viewClass('${cls.name}')">View</button>
                                            <button class="btn btn-success btn-sm" onclick="editClass('${cls.name}')">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteClass('${cls.name}')">Delete</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add class modal
        function showAddClassModal() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const teachers = data.teachers.filter(t => !t.class || t.class === '');
            
            const modalContent = `
                <form id="add-class-form">
                    <div class="form-group">
                        <label for="class-name">Class Name</label>
                        <input type="text" id="class-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="class-teacher">Class Teacher</label>
                        <select id="class-teacher" class="form-control">
                            <option value="">Not assigned</option>
                            ${teachers.map(teacher => `
                                <option value="${teacher.id}">${teacher.firstName} ${teacher.lastName}</option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Class</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Class';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-class-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const className = document.getElementById('class-name').value;
                const teacherId = parseInt(document.getElementById('class-teacher').value);
                
                // Check if class already exists
                if (data.classes.some(c => c.name === className)) {
                    alert('Class with this name already exists!');
                    return;
                }
                
                const newClass = {
                    name: className,
                    createdAt: new Date().toISOString()
                };
                
                data.classes.push(newClass);
                
                // Assign teacher to class if selected
                if (teacherId) {
                    const teacherIndex = data.teachers.findIndex(t => t.id === teacherId);
                    if (teacherIndex !== -1) {
                        data.teachers[teacherIndex].class = className;
                    }
                }
                
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Class added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('classes');
            });
        }
        
        // View class details
        function viewClass(className) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const cls = data.classes.find(c => c.name === className);
            const teacher = data.teachers.find(t => t.class === className);
            const students = data.students.filter(s => s.class === className);
            
            if (!cls) {
                alert('Class not found');
                return;
            }
            
            const modalContent = `
                <div class="class-profile">
                    <div class="class-header mb-3">
                        <h4>${className}</h4>
                    </div>
                    
                    <div class="tabs mb-3">
                        <div class="tab active" data-tab="info">Basic Info</div>
                        <div class="tab" data-tab="students">Students</div>
                    </div>
                    
                    <div class="tab-content active" id="info-tab">
                        <table class="table table-bordered">
                            <tr>
                                <th>Class Teacher</th>
                                <td>${teacher ? `${teacher.firstName} ${teacher.lastName}` : 'Not assigned'}</td>
                            </tr>
                            <tr>
                                <th>Number of Students</th>
                                <td>${students.length}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="students-tab">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Name</th>
                                    <th>Gender</th>
                                    <th>Parent Contact</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${students.map(student => `
                                    <tr>
                                        <td>${student.id}</td>
                                        <td>${student.firstName} ${student.lastName}</td>
                                        <td>${student.gender || 'N/A'}</td>
                                        <td>${student.parentPhone || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Class: ${className}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        // Edit class
        function editClass(className) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const cls = data.classes.find(c => c.name === className);
            const currentTeacher = data.teachers.find(t => t.class === className);
            const availableTeachers = data.teachers.filter(t => !t.class || t.class === className);
            
            if (!cls) {
                alert('Class not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-class-form">
                    <div class="form-group">
                        <label for="edit-class-name">Class Name</label>
                        <input type="text" id="edit-class-name" class="form-control" value="${className}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-class-teacher">Class Teacher</label>
                        <select id="edit-class-teacher" class="form-control">
                            <option value="">Not assigned</option>
                            ${availableTeachers.map(teacher => `
                                <option value="${teacher.id}" ${currentTeacher && currentTeacher.id === teacher.id ? 'selected' : ''}>
                                    ${teacher.firstName} ${teacher.lastName}
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Class</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Class: ${className}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-class-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newClassName = document.getElementById('edit-class-name').value;
                const teacherId = parseInt(document.getElementById('edit-class-teacher').value);
                
                // Check if class name is changed and new name already exists
                if (newClassName !== className && data.classes.some(c => c.name === newClassName)) {
                    alert('Class with this name already exists!');
                    return;
                }
                
                // Update class name
                const classIndex = data.classes.findIndex(c => c.name === className);
                if (classIndex !== -1) {
                    data.classes[classIndex].name = newClassName;
                    data.classes[classIndex].updatedAt = new Date().toISOString();
                }
                
                // Update students' class
                data.students.forEach(student => {
                    if (student.class === className) {
                        student.class = newClassName;
                    }
                });
                
                // Remove current teacher from class
                if (currentTeacher) {
                    const currentTeacherIndex = data.teachers.findIndex(t => t.id === currentTeacher.id);
                    if (currentTeacherIndex !== -1) {
                        data.teachers[currentTeacherIndex].class = '';
                    }
                }
                
                // Assign new teacher to class if selected
                if (teacherId) {
                    const teacherIndex = data.teachers.findIndex(t => t.id === teacherId);
                    if (teacherIndex !== -1) {
                        data.teachers[teacherIndex].class = newClassName;
                    }
                }
                
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Class updated successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('classes');
            });
        }
        
        // Delete class
        function deleteClass(className) {
            if (confirm(`Are you sure you want to delete the class ${className}? This will unassign all students and teacher from this class.`)) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                
                // Remove class
                const classIndex = data.classes.findIndex(c => c.name === className);
                if (classIndex !== -1) {
                    data.classes.splice(classIndex, 1);
                }
                
                // Unassign students from this class
                data.students.forEach(student => {
                    if (student.class === className) {
                        student.class = '';
                    }
                });
                
                // Unassign teacher from this class
                const teacher = data.teachers.find(t => t.class === className);
                if (teacher) {
                    const teacherIndex = data.teachers.findIndex(t => t.id === teacher.id);
                    if (teacherIndex !== -1) {
                        data.teachers[teacherIndex].class = '';
                    }
                }
                
                localStorage.setItem('sms_data', JSON.stringify(data));
                alert('Class deleted successfully!');
                loadPage('classes');
            }
        }
        
        // Load subjects page
        function loadSubjects() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddSubjectModal()">
                        <i class="fas fa-plus"></i> Add Subject
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Subject Name</th>
                                <th>Subject Code</th>
                                <th>Teachers</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.subjects.map(subject => {
                                const teachers = data.teachers.filter(t => t.subjects && t.subjects.includes(subject.name));
                                return `
                                    <tr>
                                        <td>${subject.name}</td>
                                        <td>${subject.code || 'N/A'}</td>
                                        <td>${teachers.length} teachers</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="viewSubject('${subject.name}')">View</button>
                                            <button class="btn btn-success btn-sm" onclick="editSubject('${subject.name}')">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteSubject('${subject.name}')">Delete</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add subject modal
        function showAddSubjectModal() {
            const modalContent = `
                <form id="add-subject-form">
                    <div class="form-group">
                        <label for="subject-name">Subject Name</label>
                        <input type="text" id="subject-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="subject-code">Subject Code</label>
                        <input type="text" id="subject-code" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Subject</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Subject';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-subject-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const subjectName = document.getElementById('subject-name').value;
                const subjectCode = document.getElementById('subject-code').value;
                
                // Check if subject already exists
                if (data.subjects.some(s => s.name === subjectName)) {
                    alert('Subject with this name already exists!');
                    return;
                }
                
                const newSubject = {
                    name: subjectName,
                    code: subjectCode,
                    createdAt: new Date().toISOString()
                };
                
                data.subjects.push(newSubject);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Subject added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('subjects');
            });
        }
        
        // View subject details
        function viewSubject(subjectName) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const subject = data.subjects.find(s => s.name === subjectName);
            const teachers = data.teachers.filter(t => t.subjects && t.subjects.includes(subjectName));
            
            if (!subject) {
                alert('Subject not found');
                return;
            }
            
            const modalContent = `
                <div class="subject-profile">
                    <div class="subject-header mb-3">
                        <h4>${subjectName}</h4>
                        <p>${subject.code ? `Code: ${subject.code}` : ''}</p>
                    </div>
                    
                    <div class="tabs mb-3">
                        <div class="tab active" data-tab="info">Basic Info</div>
                        <div class="tab" data-tab="teachers">Teachers</div>
                    </div>
                    
                    <div class="tab-content active" id="info-tab">
                        <table class="table table-bordered">
                            <tr>
                                <th>Subject Name</th>
                                <td>${subjectName}</td>
                            </tr>
                            <tr>
                                <th>Subject Code</th>
                                <td>${subject.code || 'N/A'}</td>
                            </tr>
                            <tr>
                                <th>Number of Teachers</th>
                                <td>${teachers.length}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="teachers-tab">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Teacher ID</th>
                                    <th>Name</th>
                                    <th>Class</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${teachers.map(teacher => `
                                    <tr>
                                        <td>${teacher.id}</td>
                                        <td>${teacher.firstName} ${teacher.lastName}</td>
                                        <td>${teacher.class || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Subject: ${subjectName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        // Edit subject
        function editSubject(subjectName) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const subject = data.subjects.find(s => s.name === subjectName);
            
            if (!subject) {
                alert('Subject not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-subject-form">
                    <div class="form-group">
                        <label for="edit-subject-name">Subject Name</label>
                        <input type="text" id="edit-subject-name" class="form-control" value="${subjectName}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-subject-code">Subject Code</label>
                        <input type="text" id="edit-subject-code" class="form-control" value="${subject.code || ''}">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Subject</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Subject: ${subjectName}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-subject-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newSubjectName = document.getElementById('edit-subject-name').value;
                const subjectCode = document.getElementById('edit-subject-code').value;
                
                // Check if subject name is changed and new name already exists
                if (newSubjectName !== subjectName && data.subjects.some(s => s.name === newSubjectName)) {
                    alert('Subject with this name already exists!');
                    return;
                }
                
                // Update subject
                const subjectIndex = data.subjects.findIndex(s => s.name === subjectName);
                if (subjectIndex !== -1) {
                    data.subjects[subjectIndex].name = newSubjectName;
                    data.subjects[subjectIndex].code = subjectCode;
                    data.subjects[subjectIndex].updatedAt = new Date().toISOString();
                }
                
                // Update teachers' subjects
                data.teachers.forEach(teacher => {
                    if (teacher.subjects && teacher.subjects.includes(subjectName)) {
                        const subjectIndex = teacher.subjects.indexOf(subjectName);
                        teacher.subjects[subjectIndex] = newSubjectName;
                    }
                });
                
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Subject updated successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('subjects');
            });
        }
        
        // Delete subject
        function deleteSubject(subjectName) {
            if (confirm(`Are you sure you want to delete the subject ${subjectName}? This will remove this subject from all teachers.`)) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                
                // Remove subject
                const subjectIndex = data.subjects.findIndex(s => s.name === subjectName);
                if (subjectIndex !== -1) {
                    data.subjects.splice(subjectIndex, 1);
                }
                
                // Remove subject from teachers
                data.teachers.forEach(teacher => {
                    if (teacher.subjects && teacher.subjects.includes(subjectName)) {
                        teacher.subjects = teacher.subjects.filter(s => s !== subjectName);
                    }
                });
                
                localStorage.setItem('sms_data', JSON.stringify(data));
                alert('Subject deleted successfully!');
                loadPage('subjects');
            }
        }
        
        // Load exams page
        function loadExams() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddExamModal()">
                        <i class="fas fa-plus"></i> Add Exam
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Exam Name</th>
                                <th>Term</th>
                                <th>Academic Year</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.exams.map(exam => `
                                <tr>
                                    <td>${exam.name}</td>
                                    <td>${exam.term}</td>
                                    <td>${exam.academicYear}</td>
                                    <td>${exam.startDate || 'N/A'}</td>
                                    <td>${exam.endDate || 'N/A'}</td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" onclick="viewExam(${exam.id})">View</button>
                                        <button class="btn btn-success btn-sm" onclick="editExam(${exam.id})">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteExam(${exam.id})">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add exam modal
        function showAddExamModal() {
            const modalContent = `
                <form id="add-exam-form">
                    <div class="form-group">
                        <label for="exam-name">Exam Name</label>
                        <input type="text" id="exam-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="exam-term">Term</label>
                        <select id="exam-term" class="form-control" required>
                            <option value="1">Term 1</option>
                            <option value="2">Term 2</option>
                            <option value="3">Term 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exam-academic-year">Academic Year</label>
                        <input type="text" id="exam-academic-year" class="form-control" value="2023/2024" required>
                    </div>
                    <div class="form-group">
                        <label for="exam-start-date">Start Date</label>
                        <input type="date" id="exam-start-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="exam-end-date">End Date</label>
                        <input type="date" id="exam-end-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Exam</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Exam';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-exam-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.exams.length > 0 ? Math.max(...data.exams.map(e => e.id)) + 1 : 1;
                
                const newExam = {
                    id: newId,
                    name: document.getElementById('exam-name').value,
                    term: document.getElementById('exam-term').value,
                    academicYear: document.getElementById('exam-academic-year').value,
                    startDate: document.getElementById('exam-start-date').value,
                    endDate: document.getElementById('exam-end-date').value,
                    createdAt: new Date().toISOString()
                };
                
                data.exams.push(newExam);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Exam added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('exams');
            });
        }
        
        // View exam details
        function viewExam(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const exam = data.exams.find(e => e.id === id);
            
            if (!exam) {
                alert('Exam not found');
                return;
            }
            
            const modalContent = `
                <div class="exam-profile">
                    <div class="exam-header mb-3">
                        <h4>${exam.name}</h4>
                        <p>Term ${exam.term}, ${exam.academicYear}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Exam Name</th>
                            <td>${exam.name}</td>
                        </tr>
                        <tr>
                            <th>Term</th>
                            <td>${exam.term}</td>
                        </tr>
                        <tr>
                            <th>Academic Year</th>
                            <td>${exam.academicYear}</td>
                        </tr>
                        <tr>
                            <th>Start Date</th>
                            <td>${exam.startDate || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>End Date</th>
                            <td>${exam.endDate || 'N/A'}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Exam: ${exam.name}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Edit exam
        function editExam(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const exam = data.exams.find(e => e.id === id);
            
            if (!exam) {
                alert('Exam not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-exam-form">
                    <input type="hidden" id="edit-exam-id" value="${exam.id}">
                    <div class="form-group">
                        <label for="edit-exam-name">Exam Name</label>
                        <input type="text" id="edit-exam-name" class="form-control" value="${exam.name}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-exam-term">Term</label>
                        <select id="edit-exam-term" class="form-control" required>
                            <option value="1" ${exam.term === '1' ? 'selected' : ''}>Term 1</option>
                            <option value="2" ${exam.term === '2' ? 'selected' : ''}>Term 2</option>
                            <option value="3" ${exam.term === '3' ? 'selected' : ''}>Term 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-exam-academic-year">Academic Year</label>
                        <input type="text" id="edit-exam-academic-year" class="form-control" value="${exam.academicYear}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-exam-start-date">Start Date</label>
                        <input type="date" id="edit-exam-start-date" class="form-control" value="${exam.startDate || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-exam-end-date">End Date</label>
                        <input type="date" id="edit-exam-end-date" class="form-control" value="${exam.endDate || ''}">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Exam</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Exam: ${exam.name}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-exam-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const examIndex = data.exams.findIndex(e => e.id === id);
                
                if (examIndex !== -1) {
                    data.exams[examIndex] = {
                        ...data.exams[examIndex],
                        name: document.getElementById('edit-exam-name').value,
                        term: document.getElementById('edit-exam-term').value,
                        academicYear: document.getElementById('edit-exam-academic-year').value,
                        startDate: document.getElementById('edit-exam-start-date').value,
                        endDate: document.getElementById('edit-exam-end-date').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    alert('Exam updated successfully!');
                    document.getElementById('modal').style.display = 'none';
                    loadPage('exams');
                }
            });
        }
        
        // Delete exam
        function deleteExam(id) {
            if (confirm('Are you sure you want to delete this exam?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const examIndex = data.exams.findIndex(e => e.id === id);
                
                if (examIndex !== -1) {
                    data.exams.splice(examIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Exam deleted successfully!');
                    loadPage('exams');
                }
            }
        }
        
        // Load fees page
        function loadFees() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddFeeModal()">
                        <i class="fas fa-plus"></i> Add Fee Structure
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fee Name</th>
                                <th>Class</th>
                                <th>Amount</th>
                                <th>Term</th>
                                <th>Academic Year</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.fees.map(fee => `
                                <tr>
                                    <td>${fee.name}</td>
                                    <td>${fee.class || 'All Classes'}</td>
                                    <td>$${fee.amount}</td>
                                    <td>Term ${fee.term}</td>
                                    <td>${fee.academicYear}</td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" onclick="viewFee(${fee.id})">View</button>
                                        <button class="btn btn-success btn-sm" onclick="editFee(${fee.id})">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteFee(${fee.id})">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add fee modal
        function showAddFeeModal() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const classes = data.classes;
            
            const modalContent = `
                <form id="add-fee-form">
                    <div class="form-group">
                        <label for="fee-name">Fee Name</label>
                        <input type="text" id="fee-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fee-class">Class (Leave empty for all classes)</label>
                        <select id="fee-class" class="form-control">
                            <option value="">All Classes</option>
                            ${classes.map(cls => `<option value="${cls.name}">${cls.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fee-amount">Amount</label>
                        <input type="number" id="fee-amount" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fee-term">Term</label>
                        <select id="fee-term" class="form-control" required>
                            <option value="1">Term 1</option>
                            <option value="2">Term 2</option>
                            <option value="3">Term 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fee-academic-year">Academic Year</label>
                        <input type="text" id="fee-academic-year" class="form-control" value="2023/2024" required>
                    </div>
                    <div class="form-group">
                        <label for="fee-due-date">Due Date</label>
                        <input type="date" id="fee-due-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Fee Structure</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New Fee Structure';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-fee-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.fees.length > 0 ? Math.max(...data.fees.map(f => f.id)) + 1 : 1;
                
                const newFee = {
                    id: newId,
                    name: document.getElementById('fee-name').value,
                    class: document.getElementById('fee-class').value,
                    amount: parseFloat(document.getElementById('fee-amount').value),
                    term: document.getElementById('fee-term').value,
                    academicYear: document.getElementById('fee-academic-year').value,
                    dueDate: document.getElementById('fee-due-date').value,
                    createdAt: new Date().toISOString()
                };
                
                data.fees.push(newFee);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Fee structure added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('fees');
            });
        }
        
        // View fee details
        function viewFee(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const fee = data.fees.find(f => f.id === id);
            
            if (!fee) {
                alert('Fee not found');
                return;
            }
            
            const modalContent = `
                <div class="fee-profile">
                    <div class="fee-header mb-3">
                        <h4>${fee.name}</h4>
                        <p>Term ${fee.term}, ${fee.academicYear}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Fee Name</th>
                            <td>${fee.name}</td>
                        </tr>
                        <tr>
                            <th>Class</th>
                            <td>${fee.class || 'All Classes'}</td>
                        </tr>
                        <tr>
                            <th>Amount</th>
                            <td>$${fee.amount}</td>
                        </tr>
                        <tr>
                            <th>Term</th>
                            <td>Term ${fee.term}</td>
                        </tr>
                        <tr>
                            <th>Academic Year</th>
                            <td>${fee.academicYear}</td>
                        </tr>
                        <tr>
                            <th>Due Date</th>
                            <td>${fee.dueDate || 'N/A'}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Fee: ${fee.name}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Edit fee
        function editFee(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const fee = data.fees.find(f => f.id === id);
            const classes = data.classes;
            
            if (!fee) {
                alert('Fee not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-fee-form">
                    <input type="hidden" id="edit-fee-id" value="${fee.id}">
                    <div class="form-group">
                        <label for="edit-fee-name">Fee Name</label>
                        <input type="text" id="edit-fee-name" class="form-control" value="${fee.name}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-fee-class">Class (Leave empty for all classes)</label>
                        <select id="edit-fee-class" class="form-control">
                            <option value="">All Classes</option>
                            ${classes.map(cls => `<option value="${cls.name}" ${fee.class === cls.name ? 'selected' : ''}>${cls.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-fee-amount">Amount</label>
                        <input type="number" id="edit-fee-amount" class="form-control" value="${fee.amount}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-fee-term">Term</label>
                        <select id="edit-fee-term" class="form-control" required>
                            <option value="1" ${fee.term === '1' ? 'selected' : ''}>Term 1</option>
                            <option value="2" ${fee.term === '2' ? 'selected' : ''}>Term 2</option>
                            <option value="3" ${fee.term === '3' ? 'selected' : ''}>Term 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-fee-academic-year">Academic Year</label>
                        <input type="text" id="edit-fee-academic-year" class="form-control" value="${fee.academicYear}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-fee-due-date">Due Date</label>
                        <input type="date" id="edit-fee-due-date" class="form-control" value="${fee.dueDate || ''}">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Fee Structure</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit Fee: ${fee.name}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-fee-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const feeIndex = data.fees.findIndex(f => f.id === id);
                
                if (feeIndex !== -1) {
                    data.fees[feeIndex] = {
                        ...data.fees[feeIndex],
                        name: document.getElementById('edit-fee-name').value,
                        class: document.getElementById('edit-fee-class').value,
                        amount: parseFloat(document.getElementById('edit-fee-amount').value),
                        term: document.getElementById('edit-fee-term').value,
                        academicYear: document.getElementById('edit-fee-academic-year').value,
                        dueDate: document.getElementById('edit-fee-due-date').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    alert('Fee structure updated successfully!');
                    document.getElementById('modal').style.display = 'none';
                    loadPage('fees');
                }
            });
        }
        
        // Delete fee
        function deleteFee(id) {
            if (confirm('Are you sure you want to delete this fee structure?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const feeIndex = data.fees.findIndex(f => f.id === id);
                
                if (feeIndex !== -1) {
                    data.fees.splice(feeIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Fee structure deleted successfully!');
                    loadPage('fees');
                }
            }
        }
        
        // Load payments page
        function loadPayments() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddPaymentModal()">
                        <i class="fas fa-plus"></i> Record Payment
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Receipt No</th>
                                <th>Student</th>
                                <th>Fee</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Recorded By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.payments.map(payment => {
                                const student = data.students.find(s => s.id === payment.studentId);
                                const fee = data.fees.find(f => f.id === payment.feeId);
                                const recordedBy = data.users.find(u => u.id === payment.recordedBy);
                                return `
                                    <tr>
                                        <td>${payment.receiptNo}</td>
                                        <td>${student ? `${student.firstName} ${student.lastName}` : 'N/A'}</td>
                                        <td>${fee ? fee.name : 'N/A'}</td>
                                        <td>$${payment.amount}</td>
                                        <td>${payment.paymentDate || 'N/A'}</td>
                                        <td>${recordedBy ? recordedBy.name : 'N/A'}</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="viewPayment(${payment.id})">View</button>
                                            <button class="btn btn-danger btn-sm" onclick="deletePayment(${payment.id})">Delete</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add payment modal
        function showAddPaymentModal() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const students = data.students;
            const fees = data.fees;
            const currentUser = JSON.parse(sessionStorage.getItem('current_user'));
            
            const modalContent = `
                <form id="add-payment-form">
                    <div class="form-group">
                        <label for="payment-student">Student</label>
                        <select id="payment-student" class="form-control" required>
                            <option value="">Select Student</option>
                            ${students.map(student => `
                                <option value="${student.id}">${student.firstName} ${student.lastName} (${student.class || 'No Class'})</option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-fee">Fee</label>
                        <select id="payment-fee" class="form-control" required>
                            <option value="">Select Fee</option>
                            ${fees.map(fee => `
                                <option value="${fee.id}">${fee.name} (${fee.class || 'All Classes'}) - $${fee.amount}</option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-amount">Amount</label>
                        <input type="number" id="payment-amount" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="payment-date">Payment Date</label>
                        <input type="date" id="payment-date" class="form-control" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="form-group">
                        <label for="payment-method">Payment Method</label>
                        <select id="payment-method" class="form-control">
                            <option value="Cash">Cash</option>
                            <option value="Cheque">Cheque</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Mobile Money">Mobile Money</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-notes">Notes</label>
                        <textarea id="payment-notes" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Record Payment</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Record New Payment';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.payments.length > 0 ? Math.max(...data.payments.map(p => p.id)) + 1 : 1;
                const receiptNo = `RCPT-${new Date().getFullYear()}${(new Date().getMonth() + 1).toString().padStart(2, '0')}${new Date().getDate().toString().padStart(2, '0')}-${newId.toString().padStart(4, '0')}`;
                
                const newPayment = {
                    id: newId,
                    receiptNo: receiptNo,
                    studentId: parseInt(document.getElementById('payment-student').value),
                    feeId: parseInt(document.getElementById('payment-fee').value),
                    amount: parseFloat(document.getElementById('payment-amount').value),
                    paymentDate: document.getElementById('payment-date').value,
                    paymentMethod: document.getElementById('payment-method').value,
                    notes: document.getElementById('payment-notes').value,
                    recordedBy: currentUser.id,
                    createdAt: new Date().toISOString()
                };
                
                data.payments.push(newPayment);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Payment recorded successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('payments');
            });
        }
        
        // View payment details
        function viewPayment(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const payment = data.payments.find(p => p.id === id);
            const student = payment ? data.students.find(s => s.id === payment.studentId) : null;
            const fee = payment ? data.fees.find(f => f.id === payment.feeId) : null;
            const recordedBy = payment ? data.users.find(u => u.id === payment.recordedBy) : null;
            
            if (!payment) {
                alert('Payment not found');
                return;
            }
            
            const modalContent = `
                <div class="payment-profile">
                    <div class="payment-header mb-3">
                        <h4>Receipt: ${payment.receiptNo}</h4>
                        <p>Payment Date: ${payment.paymentDate || 'N/A'}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Student</th>
                            <td>${student ? `${student.firstName} ${student.lastName} (${student.class || 'No Class'})` : 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Fee</th>
                            <td>${fee ? fee.name : 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Amount</th>
                            <td>$${payment.amount}</td>
                        </tr>
                        <tr>
                            <th>Payment Method</th>
                            <td>${payment.paymentMethod || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Payment Date</th>
                            <td>${payment.paymentDate || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Recorded By</th>
                            <td>${recordedBy ? recordedBy.name : 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Notes</th>
                            <td>${payment.notes || 'N/A'}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Payment: ${payment.receiptNo}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Delete payment
        function deletePayment(id) {
            if (confirm('Are you sure you want to delete this payment record?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const paymentIndex = data.payments.findIndex(p => p.id === id);
                
                if (paymentIndex !== -1) {
                    data.payments.splice(paymentIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Payment deleted successfully!');
                    loadPage('payments');
                }
            }
        }
        
        // Load expenses page
        function loadExpenses() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddExpenseModal()">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Expense ID</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Recorded By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.expenses.map(expense => {
                                const recordedBy = data.users.find(u => u.id === expense.recordedBy);
                                return `
                                    <tr>
                                        <td>${expense.id}</td>
                                        <td>${expense.description}</td>
                                        <td>$${expense.amount}</td>
                                        <td>${expense.date || 'N/A'}</td>
                                        <td>${expense.category || 'N/A'}</td>
                                        <td>${recordedBy ? recordedBy.name : 'N/A'}</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="viewExpense(${expense.id})">View</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteExpense(${expense.id})">Delete</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add expense modal
        function showAddExpenseModal() {
            const currentUser = JSON.parse(sessionStorage.getItem('current_user'));
            
            const modalContent = `
                <form id="add-expense-form">
                    <div class="form-group">
                        <label for="expense-description">Description</label>
                        <input type="text" id="expense-description" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="expense-amount">Amount</label>
                        <input type="number" id="expense-amount" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="expense-date">Date</label>
                        <input type="date" id="expense-date" class="form-control" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="form-group">
                        <label for="expense-category">Category</label>
                        <select id="expense-category" class="form-control">
                            <option value="Salaries">Salaries</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Supplies">Supplies</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expense-notes">Notes</label>
                        <textarea id="expense-notes" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Record Expense</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Record New Expense';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-expense-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const newId = data.expenses.length > 0 ? Math.max(...data.expenses.map(e => e.id)) + 1 : 1;
                
                const newExpense = {
                    id: newId,
                    description: document.getElementById('expense-description').value,
                    amount: parseFloat(document.getElementById('expense-amount').value),
                    date: document.getElementById('expense-date').value,
                    category: document.getElementById('expense-category').value,
                    notes: document.getElementById('expense-notes').value,
                    recordedBy: currentUser.id,
                    createdAt: new Date().toISOString()
                };
                
                data.expenses.push(newExpense);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('Expense recorded successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('expenses');
            });
        }
        
        // View expense details
        function viewExpense(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const expense = data.expenses.find(e => e.id === id);
            const recordedBy = expense ? data.users.find(u => u.id === expense.recordedBy) : null;
            
            if (!expense) {
                alert('Expense not found');
                return;
            }
            
            const modalContent = `
                <div class="expense-profile">
                    <div class="expense-header mb-3">
                        <h4>Expense #${expense.id}</h4>
                        <p>Date: ${expense.date || 'N/A'}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Description</th>
                            <td>${expense.description}</td>
                        </tr>
                        <tr>
                            <th>Amount</th>
                            <td>$${expense.amount}</td>
                        </tr>
                        <tr>
                            <th>Date</th>
                            <td>${expense.date || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Category</th>
                            <td>${expense.category || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Recorded By</th>
                            <td>${recordedBy ? recordedBy.name : 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Notes</th>
                            <td>${expense.notes || 'N/A'}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `Expense: ${expense.description}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Delete expense
        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense record?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const expenseIndex = data.expenses.findIndex(e => e.id === id);
                
                if (expenseIndex !== -1) {
                    data.expenses.splice(expenseIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('Expense deleted successfully!');
                    loadPage('expenses');
                }
            }
        }
        
        // Load users page
        function loadUsers() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const currentUser = JSON.parse(sessionStorage.getItem('current_user'));
            const content = `
                <div class="header-actions mb-3">
                    <button class="btn btn-primary" onclick="showAddUserModal()">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.users.map(user => {
                                const role = data.roles.find(r => r.id === user.role);
                                return `
                                    <tr>
                                        <td>${user.username}</td>
                                        <td>${user.name}</td>
                                        <td>${role ? role.name : user.role}</td>
                                        <td>${user.email || 'N/A'}</td>
                                        <td><span class="status ${user.status || 'active'}">${user.status || 'Active'}</span></td>
                                        <td>
                                            ${user.id !== currentUser.id ? `
                                                <button class="btn btn-primary btn-sm" onclick="viewUser(${user.id})">View</button>
                                                <button class="btn btn-success btn-sm" onclick="editUser(${user.id})">Edit</button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // Show add user modal
        function showAddUserModal() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const roles = data.roles;
            
            const modalContent = `
                <form id="add-user-form">
                    <div class="form-group">
                        <label for="user-username">Username</label>
                        <input type="text" id="user-username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="user-password">Password</label>
                        <input type="password" id="user-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="user-name">Full Name</label>
                        <input type="text" id="user-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="user-role">Role</label>
                        <select id="user-role" class="form-control" required>
                            ${roles.map(role => `
                                <option value="${role.id}">${role.name}</option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-email">Email</label>
                        <input type="email" id="user-email" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="user-phone">Phone</label>
                        <input type="tel" id="user-phone" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save User</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = 'Add New User';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('add-user-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const username = document.getElementById('user-username').value;
                
                // Check if username already exists
                if (data.users.some(u => u.username === username)) {
                    alert('Username already exists!');
                    return;
                }
                
                const newId = data.users.length > 0 ? Math.max(...data.users.map(u => u.id)) + 1 : 1;
                
                const newUser = {
                    id: newId,
                    username: username,
                    password: document.getElementById('user-password').value,
                    role: document.getElementById('user-role').value,
                    name: document.getElementById('user-name').value,
                    email: document.getElementById('user-email').value,
                    phone: document.getElementById('user-phone').value,
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                };
                
                data.users.push(newUser);
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                alert('User added successfully!');
                document.getElementById('modal').style.display = 'none';
                loadPage('users');
            });
        }
        
        // View user details
        function viewUser(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const user = data.users.find(u => u.id === id);
            const role = user ? data.roles.find(r => r.id === user.role) : null;
            
            if (!user) {
                alert('User not found');
                return;
            }
            
            const modalContent = `
                <div class="user-profile">
                    <div class="user-header mb-3">
                        <h4>${user.name}</h4>
                        <p>Username: ${user.username}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <tr>
                            <th>Role</th>
                            <td>${role ? role.name : user.role}</td>
                        </tr>
                        <tr>
                            <th>Email</th>
                            <td>${user.email || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Phone</th>
                            <td>${user.phone || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Status</th>
                            <td><span class="status ${user.status || 'active'}">${user.status || 'Active'}</span></td>
                        </tr>
                        <tr>
                            <th>Last Login</th>
                            <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'}</td>
                        </tr>
                        <tr>
                            <th>Account Created</th>
                            <td>${user.createdAt ? new Date(user.createdAt).toLocaleString() : 'N/A'}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = `User: ${user.name}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }
        
        // Edit user
        function editUser(id) {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const user = data.users.find(u => u.id === id);
            const roles = data.roles;
            
            if (!user) {
                alert('User not found');
                return;
            }
            
            const modalContent = `
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id" value="${user.id}">
                    <div class="form-group">
                        <label for="edit-user-username">Username</label>
                        <input type="text" id="edit-user-username" class="form-control" value="${user.username}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-user-password">Password (Leave blank to keep current)</label>
                        <input type="password" id="edit-user-password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="edit-user-name">Full Name</label>
                        <input type="text" id="edit-user-name" class="form-control" value="${user.name}" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-user-role">Role</label>
                        <select id="edit-user-role" class="form-control" required>
                            ${roles.map(role => `
                                <option value="${role.id}" ${user.role === role.id ? 'selected' : ''}>${role.name}</option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-user-email">Email</label>
                        <input type="email" id="edit-user-email" class="form-control" value="${user.email || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-user-phone">Phone</label>
                        <input type="tel" id="edit-user-phone" class="form-control" value="${user.phone || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-user-status">Status</label>
                        <select id="edit-user-status" class="form-control">
                            <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update User</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal-title').textContent = `Edit User: ${user.name}`;
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('edit-user-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const userIndex = data.users.findIndex(u => u.id === id);
                
                if (userIndex !== -1) {
                    const password = document.getElementById('edit-user-password').value;
                    
                    data.users[userIndex] = {
                        ...data.users[userIndex],
                        username: document.getElementById('edit-user-username').value,
                        password: password ? password : data.users[userIndex].password,
                        name: document.getElementById('edit-user-name').value,
                        role: document.getElementById('edit-user-role').value,
                        email: document.getElementById('edit-user-email').value,
                        phone: document.getElementById('edit-user-phone').value,
                        status: document.getElementById('edit-user-status').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    
                    alert('User updated successfully!');
                    document.getElementById('modal').style.display = 'none';
                    loadPage('users');
                }
            });
        }
        
        // Delete user
        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                const data = JSON.parse(localStorage.getItem('sms_data'));
                const userIndex = data.users.findIndex(u => u.id === id);
                
                if (userIndex !== -1) {
                    data.users.splice(userIndex, 1);
                    localStorage.setItem('sms_data', JSON.stringify(data));
                    alert('User deleted successfully!');
                    loadPage('users');
                }
            }
        }
        
        // Load settings page
        function loadSettings() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const settings = data.settings;
            
            const content = `
                <form id="settings-form">
                    <div class="form-group">
                        <label for="settings-school-name">School Name</label>
                        <input type="text" id="settings-school-name" class="form-control" value="${settings.schoolName}" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-academic-year">Academic Year</label>
                        <input type="text" id="settings-academic-year" class="form-control" value="${settings.academicYear}" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-term">Current Term</label>
                        <select id="settings-term" class="form-control" required>
                            <option value="1" ${settings.term === '1' ? 'selected' : ''}>Term 1</option>
                            <option value="2" ${settings.term === '2' ? 'selected' : ''}>Term 2</option>
                            <option value="3" ${settings.term === '3' ? 'selected' : ''}>Term 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="settings-logo">School Logo URL</label>
                        <input type="text" id="settings-logo" class="form-control" value="${settings.logo || ''}">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </div>
                </form>
                
                <div class="mt-4">
                    <h4>Data Management</h4>
                    <button class="btn btn-danger" onclick="confirmDataReset()">
                        <i class="fas fa-trash"></i> Reset All Data
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="btn btn-secondary" onclick="showImportModal()">
                        <i class="fas fa-upload"></i> Import Data
                    </button>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
            
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const data = JSON.parse(localStorage.getItem('sms_data'));
                
                data.settings = {
                    schoolName: document.getElementById('settings-school-name').value,
                    academicYear: document.getElementById('settings-academic-year').value,
                    term: document.getElementById('settings-term').value,
                    logo: document.getElementById('settings-logo').value
                };
                
                localStorage.setItem('sms_data', JSON.stringify(data));
                
                // Update UI
                document.getElementById('school-name').textContent = data.settings.schoolName;
                
                alert('Settings saved successfully!');
            });
        }
        
        // Confirm data reset
        function confirmDataReset() {
            if (confirm('WARNING: This will delete ALL data and reset the system to its initial state. Are you sure you want to continue?')) {
                localStorage.setItem('sms_data', JSON.stringify(dataStructure));
                alert('All data has been reset to default!');
                loadPage('settings');
            }
        }
        
        // Export data
        function exportData() {
            const data = JSON.parse(localStorage.getItem('sms_data'));
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'school-management-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Show import modal
        function showImportModal() {
            const modalContent = `
                <div class="alert alert-danger">
                    <strong>Warning:</strong> Importing data will overwrite all current data. Make sure to export your current data first if you want to keep it.
                </div>
                <div class="form-group">
                    <label for="import-file">Select JSON file to import</label>
                    <input type="file" id="import-file" class="form-control" accept=".json">
                </div>
                <div class="form-group">
                    <button id="import-btn" class="btn btn-primary" disabled>Import Data</button>
                </div>
            `;
            
            document.getElementById('modal-title').textContent = 'Import Data';
            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
            
            document.getElementById('import-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('import-btn').disabled = false;
                } else {
                    document.getElementById('import-btn').disabled = true;
                }
            });
            
            document.getElementById('import-btn').addEventListener('click', function() {
                const file = document.getElementById('import-file').files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        localStorage.setItem('sms_data', JSON.stringify(importedData));
                        alert('Data imported successfully!');
                        document.getElementById('modal').style.display = 'none';
                        loadPage('settings');
                    } catch (error) {
                        alert('Error importing data: Invalid file format');
                    }
                };
                reader.readAsText(file);
            });
        }
    </script>
</body>
</html>